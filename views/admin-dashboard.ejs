<%- include('header') %>
<div class="admin-container">
  <div class="admin-header">
    <div class="admin-header-content">
      <div>
        <h1 class="admin-title">Dashboard</h1>
        <p class="admin-subtitle">Manage your artworks and orders</p>
      </div>
      <button onclick="showLogoutModal()" class="admin-logout-btn">
        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 3H4C3.46957 3 2.96086 3.21071 2.58579 3.58579C2.21071 3.96086 2 4.46957 2 5V15C2 15.5304 2.21071 16.0391 2.58579 16.4142C2.96086 16.7893 3.46957 17 4 17H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 7L17 10L14 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Logout</span>
      </button>
    </div>
  </div>
  <div class="admin-stats">
    <div class="stat-card">
      <div class="stat-icon stat-icon-artworks">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 19.5C4 18.3954 4.89543 17.5 6 17.5H18C19.1046 17.5 20 18.3954 20 19.5C20 20.6046 19.1046 21.5 18 21.5H6C4.89543 21.5 4 20.6046 4 19.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M4 4.5C4 3.39543 4.89543 2.5 6 2.5H18C19.1046 2.5 20 3.39543 20 4.5C20 5.60457 19.1046 6.5 18 6.5H6C4.89543 6.5 4 5.60457 4 4.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M4 12C4 10.8954 4.89543 10 6 10H18C19.1046 10 20 10.8954 20 12C20 13.1046 19.1046 14 18 14H6C4.89543 14 4 13.1046 4 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Total Artworks</p>
        <p class="stat-value"><%= artworks.length %></p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-orders">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 12V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Total Orders</p>
        <p class="stat-value"><%= orders.length %></p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-pending">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Pending Orders</p>
        <p class="stat-value"><%= orders.filter(o => o.status === 'pending').length %></p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-delivered">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Delivered</p>
        <p class="stat-value"><%= orders.filter(o => o.status === 'delivered').length %></p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-icon-support">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Support Messages</p>
        <p class="stat-value"><%= typeof supportMessages !== 'undefined' ? supportMessages.length : 0 %></p>
      </div>
    </div>
  </div>
  <div class="admin-actions">
    <a href="/admin/new-art" class="admin-action-btn admin-add-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Add New Artwork</span>
    </a>
    <a href="/admin/artworks" class="admin-action-btn admin-artworks-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 19.5C4 18.3954 4.89543 17.5 6 17.5H18C19.1046 17.5 20 18.3954 20 19.5C20 20.6046 19.1046 21.5 18 21.5H6C4.89543 21.5 4 20.6046 4 19.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M4 4.5C4 3.39543 4.89543 2.5 6 2.5H18C19.1046 2.5 20 3.39543 20 4.5C20 5.60457 19.1046 6.5 18 6.5H6C4.89543 6.5 4 5.60457 4 4.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M4 12C4 10.8954 4.89543 10 6 10H18C19.1046 10 20 10.8954 20 12C20 13.1046 19.1046 14 18 14H6C4.89543 14 4 13.1046 4 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>My All Artworks</span>
    </a>
    <a href="/admin/orders" class="admin-action-btn admin-orders-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>All Orders</span>
    </a>
  </div>
  <div class="admin-sections">
    <div class="admin-section">
      <div class="section-header">
        <h2 class="section-title">Artworks</h2>
        <span class="section-count"><%= artworks.length %> items</span>
      </div>
      <% if (artworks.length === 0) { %>
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 19.5C4 18.3954 4.89543 17.5 6 17.5H18C19.1046 17.5 20 18.3954 20 19.5C20 20.6046 19.1046 21.5 18 21.5H6C4.89543 21.5 4 20.6046 4 19.5Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4 4.5C4 3.39543 4.89543 2.5 6 2.5H18C19.1046 2.5 20 3.39543 20 4.5C20 5.60457 19.1046 6.5 18 6.5H6C4.89543 6.5 4 5.60457 4 4.5Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>No artworks yet</h3>
          <p>Start by adding your first artwork</p>
          <a href="/admin/new-art" class="empty-state-btn">Add Artwork</a>
        </div>
      <% } else { %>
        <div class="artworks-grid-admin">
          <% artworks.forEach(a=>{ %>
            <div class="artwork-card-admin">
              <div class="artwork-image-admin">
                <img src="<%= a.image_path %>" alt="<%= a.title %>">
              </div>
              <div class="artwork-details-admin">
                <h3 class="artwork-title-admin"><%= a.title %></h3>
                <p class="artwork-price-admin">â‚¹<%= a.price %></p>
                <p class="artwork-id-admin">ID: #<%= a.id %></p>
              </div>
              <div class="artwork-actions-admin">
                <div class="artwork-buttons-wrapper">
                  <a href="/admin/art/<%= a.id %>/edit" class="edit-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Edit
                  </a>
                  <button type="button" onclick="showDeleteModal(<%= a.id %>, '<%= a.title.replace(/'/g, "\'") %>')" class="delete-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Delete
                    </button>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="admin-section">
      <div class="section-header">
        <h2 class="section-title">Orders</h2>
        <span class="section-count"><%= orders.length %> orders</span>
      </div>
      <% if (orders.length === 0) { %>
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 11L12 14L22 4" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>No orders yet</h3>
          <p>Orders will appear here when customers place them</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% orders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="admin-section">
      <div class="section-header">
        <h2 class="section-title">Support Messages</h2>
        <span class="section-count"><%= typeof supportMessages !== 'undefined' ? supportMessages.length : 0 %> messages</span>
      </div>
      <% if (typeof supportMessages === 'undefined' || supportMessages.length === 0) { %>
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>No support messages yet</h3>
          <p>Support messages from users will appear here</p>
        </div>
      <% } else { %>
        <div class="support-messages-list">
          <% supportMessages.forEach(msg => { %>
            <div class="support-message-card">
              <div class="support-message-header">
                <div class="support-message-id-badge">Message #<%= msg.id %></div>
                <span class="support-message-status-badge support-message-status-<%= msg.status %>"><%= msg.status %></span>
              </div>
              <div class="support-message-content">
                <div class="support-message-info">
                  <div class="support-message-detail-item">
                    <span class="support-message-detail-label">From:</span>
                    <span class="support-message-detail-value"><%= msg.user_name %></span>
                  </div>
                  <div class="support-message-detail-item">
                    <span class="support-message-detail-label">Email:</span>
                    <span class="support-message-detail-value"><%= msg.user_email %></span>
                  </div>
                  <div class="support-message-detail-item">
                    <span class="support-message-detail-label">Date & Time:</span>
                    <span class="support-message-detail-value"><%= new Date(msg.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="support-message-subject">
                  <h4 class="support-message-subject-title"><%= msg.subject %></h4>
                </div>
                <div class="support-message-text">
                  <p><%= msg.message %></p>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>
<div id="logoutModal" class="logout-modal-overlay" onclick="closeLogoutModal(event)">
  <div class="logout-modal-content" onclick="event.stopPropagation()">
    <div class="logout-modal-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h2 class="logout-modal-title">Are you sure?</h2>
    <p class="logout-modal-message">You are about to logout from your admin account. This action will end your current session.</p>
    <div class="logout-modal-actions">
      <button onclick="closeLogoutModal()" class="logout-modal-cancel">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Cancel</span>
      </button>
      <button onclick="confirmLogout()" class="logout-modal-confirm">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Yes, Logout</span>
      </button>
    </div>
  </div>
</div>
<div id="deleteModal" class="logout-modal-overlay" onclick="closeDeleteModal(event)">
  <div class="logout-modal-content" onclick="event.stopPropagation()">
    <div class="logout-modal-icon" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);box-shadow:0 4px 12px rgba(239,68,68,0.4)">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h2 class="logout-modal-title">Are you sure?</h2>
    <p class="logout-modal-message" id="deleteModalMessage">You are about to delete this artwork. This action cannot be undone.</p>
    <div class="logout-modal-actions">
      <button onclick="closeDeleteModal()" class="logout-modal-cancel">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Cancel</span>
      </button>
      <button onclick="confirmDelete()" class="logout-modal-confirm" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);box-shadow:0 4px 8px rgba(239,68,68,0.4)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Yes, Delete</span>
      </button>
    </div>
  </div>
</div>
<script>
function showLogoutModal() {
  document.getElementById('logoutModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}
function closeLogoutModal(event) {
  if (event && event.target !== event.currentTarget) return;
  document.getElementById('logoutModal').style.display = 'none';
  document.body.style.overflow = '';
}
function confirmLogout() {
  window.location.href = '/logout';
}
let deleteArtworkId = null;
function showDeleteModal(id, title) {
  deleteArtworkId = id;
  document.getElementById('deleteModalMessage').textContent = 'You are about to delete "' + title + '". This action cannot be undone.';
  document.getElementById('deleteModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}
function closeDeleteModal(event) {
  if (event && event.target !== event.currentTarget) return;
  document.getElementById('deleteModal').style.display = 'none';
  document.body.style.overflow = '';
  deleteArtworkId = null;
}
function confirmDelete() {
  if (deleteArtworkId) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/admin/art/' + deleteArtworkId + '/delete';
    document.body.appendChild(form);
    form.submit();
  }
}
function filterOrders(status) {
  // Hide all sections
  document.querySelectorAll('.order-status-section').forEach(section => {
    section.style.display = 'none';
  });
  
  // Remove active class from all buttons
  document.querySelectorAll('.order-filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected section
  const section = document.getElementById('section-' + status);
  if (section) {
    section.style.display = 'block';
  }
  
  // Add active class to clicked button
  const btn = document.querySelector('[data-filter="' + status + '"]');
  if (btn) {
    btn.classList.add('active');
  }
  
  // Scroll to top of section
  if (section) {
    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}
</script>
<%- include('footer') %>