<%- include('header') %>
<%- include('partials/alerts') %>
<div class="gallery-container">
  <div class="gallery-header">
    <h1 class="gallery-title">Fall in love with art</h1>
    <p class="gallery-subtitle">Turn Empty Walls into Expressions</p>
  </div>
  <% if (typeof section === 'undefined') { section = 'all'; } %>
  <div class="gallery-filters">
    <a href="/gallery?section=all" class="gallery-filter-btn <%= section === 'all' ? 'active' : '' %>">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>All Artworks</span>
    </a>
    <a href="/gallery?section=wishlist" class="gallery-filter-btn <%= section === 'wishlist' ? 'active' : '' %>">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.57831 8.50903 2.99871 7.05 2.99871C5.59096 2.99871 4.19169 3.57831 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L4.22 13.45L12 21.23L19.78 13.45L20.84 12.39C21.351 11.8792 21.7564 11.2728 22.0329 10.6054C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.0621 22.0329 6.39464C21.7564 5.72718 21.351 5.12075 20.84 4.61Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>My Wishlist</span>
    </a>
    <a href="/gallery?section=orders" class="gallery-filter-btn <%= section === 'orders' ? 'active' : '' %>">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M12 12H15M12 16H15M9 12H9.01M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>My Orders</span>
    </a>
  </div>
  <% if (section === 'orders') { %>
    <% if (typeof orders !== 'undefined' && orders.length > 0) { %>
      <div class="orders-section">
        <% orders.forEach(order => { %>
          <div class="order-card-gallery">
            <div class="order-card-image">
              <img src="<%= order.image_path %>" alt="<%= order.title %>">
            </div>
            <div class="order-card-info">
              <h3><%= order.title %></h3>
              <p class="order-price">₹<%= order.price %></p>
              <p class="order-id">Order #<%= order.id %></p>
              <p class="order-status">Status: <span class="status-<%= order.status %>"><%= order.status %></span></p>
              <p class="order-date">Date: <%= new Date(order.created_at).toLocaleDateString() %></p>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="empty-gallery">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>No orders yet</h3>
        <p>Start shopping to see your orders here</p>
      </div>
    <% } %>
  <% } else { %>
    <% if (typeof artworks !== 'undefined' && artworks.length > 0) { %>
      <div class="gallery-search-wrapper">
      <div class="gallery-search-container">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input type="text" id="artwork-search" class="gallery-search-input" placeholder="Search artworks by name..." autocomplete="off">
        <button class="search-clear-btn" id="search-clear" style="display:none;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="search-results-count" id="search-results-count"></div>
    </div>
      <div class="artworks-grid" id="artworks-grid">
        <% artworks.forEach(a => { %>
          <div class="artwork-card" data-artwork-title="<%= a.title.toLowerCase() %>" data-artwork-id="<%= a.id %>">
            <div class="artwork-image-wrapper">
              <a href="/art/<%= a.id %>" class="artwork-image-link">
                <img src="<%= a.image_path %>" alt="<%= a.title %>" class="artwork-image" loading="lazy">
              </a>
              <div class="artwork-overlay">
                <a href="/art/<%= a.id %>" class="view-btn">View Details</a>
              </div>
              <button class="like-btn <%= (typeof wishlistSet !== 'undefined' && wishlistSet.has(a.id)) || a.isLiked ? 'liked' : '' %>" data-artwork-id="<%= a.id %>" onclick="toggleLike(<%= a.id %>, this)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.57831 8.50903 2.99871 7.05 2.99871C5.59096 2.99871 4.19169 3.57831 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L4.22 13.45L12 21.23L19.78 13.45L20.84 12.39C21.351 11.8792 21.7564 11.2728 22.0329 10.6054C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.0621 22.0329 6.39464C21.7564 5.72718 21.351 5.12075 20.84 4.61Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="<%= (typeof wishlistSet !== 'undefined' && wishlistSet.has(a.id)) || a.isLiked ? 'currentColor' : 'none' %>"/>
                </svg>
              </button>
            </div>
            <div class="artwork-info">
              <h3 class="artwork-title"><a href="/art/<%= a.id %>"><%= a.title %></a></h3>
              <div class="artwork-price">
                <span class="price-current">₹<%= a.price %></span>
              </div>
              <a href="/buy/<%= a.id %>" class="buy-now-btn">Buy Now</a>
            </div>
          </div>
        <% }) %>
      </div>
    <div class="no-search-results" id="no-search-results" style="display:none;">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="11" cy="11" r="8" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="m21 21-4.35-4.35" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h3>No artworks found</h3>
      <p>Try searching with a different name</p>
    </div>
    <% } else { %>
      <div class="empty-gallery">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3><%= section === 'wishlist' ? 'Your wishlist is empty' : 'No artworks available yet' %></h3>
        <p><%= section === 'wishlist' ? 'Start liking artworks to add them to your wishlist' : 'Start building your collection' %></p>
      </div>
    <% } %>
  <% } %>
</div>
<script>
(function() {
  const searchInput = document.getElementById('artwork-search');
  const searchClear = document.getElementById('search-clear');
  const artworksGrid = document.getElementById('artworks-grid');
  const noResults = document.getElementById('no-search-results');
  const resultsCount = document.getElementById('search-results-count');
  
  if (searchInput) {
    const artworkCards = Array.from(document.querySelectorAll('.artwork-card'));
    
    function filterArtworks() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      
      if (searchTerm === '') {
        searchClear.style.display = 'none';
        resultsCount.textContent = '';
        artworkCards.forEach(card => {
          card.style.display = '';
        });
        if (artworksGrid) artworksGrid.style.display = '';
        if (noResults) noResults.style.display = 'none';
        return;
      }
      
      searchClear.style.display = 'flex';
      
      let visibleCount = 0;
      
      artworkCards.forEach(card => {
        const title = card.getAttribute('data-artwork-title') || '';
        if (title.includes(searchTerm)) {
          card.style.display = '';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      
      if (visibleCount === 0) {
        if (artworksGrid) artworksGrid.style.display = 'none';
        if (noResults) noResults.style.display = 'block';
        resultsCount.textContent = 'No results found';
      } else {
        if (artworksGrid) artworksGrid.style.display = '';
        if (noResults) noResults.style.display = 'none';
        resultsCount.textContent = visibleCount + ' result' + (visibleCount !== 1 ? 's' : '') + ' found';
      }
    }
    
    searchInput.addEventListener('input', filterArtworks);
    searchInput.addEventListener('keyup', function(e) {
      if (e.key === 'Escape') {
        searchInput.value = '';
        filterArtworks();
        searchInput.blur();
      }
    });
    
    if (searchClear) {
      searchClear.addEventListener('click', function() {
        searchInput.value = '';
        filterArtworks();
        searchInput.focus();
      });
    }
  }
})();

function toggleLike(artworkId, button) {
  fetch('/wishlist/toggle', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: 'artwork_id=' + artworkId
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      if (data.liked) {
        button.classList.add('liked');
        button.querySelector('svg path').setAttribute('fill', 'currentColor');
      } else {
        button.classList.remove('liked');
        button.querySelector('svg path').setAttribute('fill', 'none');
        if (window.location.search.includes('section=wishlist')) {
          const card = button.closest('.artwork-card');
          if (card) {
            card.style.transition = 'opacity 0.3s, transform 0.3s';
            card.style.opacity = '0';
            card.style.transform = 'scale(0.9)';
            setTimeout(() => {
              card.remove();
              const remainingCards = document.querySelectorAll('.artwork-card');
              if (remainingCards.length === 0) {
                window.location.reload();
              }
            }, 300);
          }
        }
      }
    } else {
      alert('Error: ' + (data.error || 'Failed to update wishlist'));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred. Please try again.');
  });
}
</script>
<%- include('footer') %>