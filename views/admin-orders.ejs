<%- include('header') %>
<div class="admin-container">
  <div class="admin-header">
    <div class="admin-header-content">
      <div>
        <h1 class="admin-title">All Orders</h1>
        <p class="admin-subtitle">View and manage all customer orders</p>
      </div>
      <button onclick="showLogoutModal()" class="admin-logout-btn">
        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 3H4C3.46957 3 2.96086 3.21071 2.58579 3.58579C2.21071 3.96086 2 4.46957 2 5V15C2 15.5304 2.21071 16.0391 2.58579 16.4142C2.96086 16.7893 3.46957 17 4 17H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 7L17 10L14 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Logout</span>
      </button>
    </div>
  </div>
  <a href="/admin" class="admin-back-btn">
    <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span>Back to Dashboard</span>
  </a>
  <% 
    const allOrders = orders || [];
    const pendingOrders = allOrders.filter(o => o.status === 'pending');
    const acceptedOrders = allOrders.filter(o => o.status === 'accepted');
    const shippedOrders = allOrders.filter(o => o.status === 'shipped');
    const deliveredOrders = allOrders.filter(o => o.status === 'delivered');
  %>
  <div class="order-filters">
    <button class="order-filter-btn active" data-filter="all" onclick="filterOrders('all')">
      <span>All Orders</span>
      <span class="filter-count">(<%= allOrders.length %>)</span>
    </button>
    <button class="order-filter-btn" data-filter="pending" onclick="filterOrders('pending')">
      <span>Pending</span>
      <span class="filter-count">(<%= pendingOrders.length %>)</span>
    </button>
    <button class="order-filter-btn" data-filter="accepted" onclick="filterOrders('accepted')">
      <span>Accepted</span>
      <span class="filter-count">(<%= acceptedOrders.length %>)</span>
    </button>
    <button class="order-filter-btn" data-filter="shipped" onclick="filterOrders('shipped')">
      <span>Shipped</span>
      <span class="filter-count">(<%= shippedOrders.length %>)</span>
    </button>
    <button class="order-filter-btn" data-filter="delivered" onclick="filterOrders('delivered')">
      <span>Delivered</span>
      <span class="filter-count">(<%= deliveredOrders.length %>)</span>
    </button>
  </div>
  <div class="orders-sections">
    <div class="order-status-section" id="section-all" data-section="all">
      <div class="order-section-header">
        <h2 class="order-section-title">All Orders</h2>
        <span class="order-section-count"><%= allOrders.length %> orders</span>
      </div>
      <% if (allOrders.length === 0) { %>
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 11L12 14L22 4" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>No orders yet</h3>
          <p>Orders will appear here when customers place them</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% allOrders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="order-status-section" id="section-pending" data-section="pending" style="display:none;">
      <div class="order-section-header">
        <h2 class="order-section-title">Pending Orders</h2>
        <span class="order-section-count"><%= pendingOrders.length %> orders</span>
      </div>
      <% if (pendingOrders.length === 0) { %>
        <div class="empty-state-small">
          <p>No pending orders</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% pendingOrders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="order-status-section" id="section-accepted" data-section="accepted" style="display:none;">
      <div class="order-section-header">
        <h2 class="order-section-title">Accepted Orders</h2>
        <span class="order-section-count"><%= acceptedOrders.length %> orders</span>
      </div>
      <% if (acceptedOrders.length === 0) { %>
        <div class="empty-state-small">
          <p>No accepted orders</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% acceptedOrders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="order-status-section" id="section-shipped" data-section="shipped" style="display:none;">
      <div class="order-section-header">
        <h2 class="order-section-title">Shipped Orders</h2>
        <span class="order-section-count"><%= shippedOrders.length %> orders</span>
      </div>
      <% if (shippedOrders.length === 0) { %>
        <div class="empty-state-small">
          <p>No shipped orders</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% shippedOrders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
    <div class="order-status-section" id="section-delivered" data-section="delivered" style="display:none;">
      <div class="order-section-header">
        <h2 class="order-section-title">Delivered Orders</h2>
        <span class="order-section-count"><%= deliveredOrders.length %> orders</span>
      </div>
      <% if (deliveredOrders.length === 0) { %>
        <div class="empty-state-small">
          <p>No delivered orders</p>
        </div>
      <% } else { %>
        <div class="orders-list">
          <% deliveredOrders.forEach(o=>{ %>
            <div class="order-card">
              <div class="order-header">
                <div class="order-id-badge">Order #<%= o.id %></div>
                <span class="order-status-badge order-status-<%= o.status %>"><%= o.status %></span>
              </div>
              <div class="order-content">
                <div class="order-artwork">
                  <img src="<%= o.image_path %>" alt="<%= o.title %>" class="order-artwork-image">
                  <div class="order-artwork-info">
                    <h4><%= o.title %></h4>
                  </div>
                </div>
                <div class="order-details">
                  <div class="order-detail-item">
                    <span class="order-detail-label">Buyer:</span>
                    <span class="order-detail-value"><%= o.buyer_name %></span>
                    <% if (o.buyer_email) { %>
                      <span class="order-detail-email"><%= o.buyer_email %></span>
                    <% } %>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Phone:</span>
                    <span class="order-detail-value"><%= o.phone %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Address:</span>
                    <span class="order-detail-value"><%= o.address %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Payment:</span>
                    <span class="order-detail-value order-payment-badge"><%= o.payment_method.toUpperCase() %></span>
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">Date & Time:</span>
                    <span class="order-detail-value"><%= new Date(o.created_at).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }) %></span>
                  </div>
                </div>
                <div class="order-actions">
                  <form method="post" action="/admin/order/<%= o.id %>/status" class="order-status-form">
                    <select name="status" class="order-status-select">
                      <option value="pending" <%= o.status==='pending'?'selected':'' %>>Pending</option>
                      <option value="accepted" <%= o.status==='accepted'?'selected':'' %>>Accepted</option>
                      <option value="shipped" <%= o.status==='shipped'?'selected':'' %>>Shipped</option>
                      <option value="delivered" <%= o.status==='delivered'?'selected':'' %>>Delivered</option>
                    </select>
                    <button type="submit" class="update-status-btn">Update Status</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>
<div id="logoutModal" class="logout-modal-overlay" onclick="closeLogoutModal(event)">
  <div class="logout-modal-content" onclick="event.stopPropagation()">
    <div class="logout-modal-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h2 class="logout-modal-title">Are you sure?</h2>
    <p class="logout-modal-message">You are about to logout from your admin account. This action will end your current session.</p>
    <div class="logout-modal-actions">
      <button onclick="closeLogoutModal()" class="logout-modal-cancel">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Cancel</span>
      </button>
      <button onclick="confirmLogout()" class="logout-modal-confirm">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Yes, Logout</span>
      </button>
    </div>
  </div>
</div>
<script>
function showLogoutModal() {
  document.getElementById('logoutModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}
function closeLogoutModal(event) {
  if (event && event.target !== event.currentTarget) return;
  document.getElementById('logoutModal').style.display = 'none';
  document.body.style.overflow = '';
}
function confirmLogout() {
  window.location.href = '/logout';
}
function filterOrders(status) {
  // Hide all sections
  document.querySelectorAll('.order-status-section').forEach(section => {
    section.style.display = 'none';
  });
  
  // Remove active class from all buttons
  document.querySelectorAll('.order-filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected section
  const section = document.getElementById('section-' + status);
  if (section) {
    section.style.display = 'block';
  }
  
  // Add active class to clicked button
  const btn = document.querySelector('[data-filter="' + status + '"]');
  if (btn) {
    btn.classList.add('active');
  }
  
  // Scroll to top of section
  if (section) {
    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}
</script>
<%- include('footer') %>